<div class="container py-5 events-index">
  <h1 class="mb-4 text-center">ğŸ“… Tous les Ã©vÃ©nements gÃ©nÃ©rÃ©s</h1>

  <!-- ğŸ” Barre de recherche + filtre date -->
  <div class="mb-4">
    <%= form_with url: events_path, method: :get, local: true, class: "row g-2 justify-content-center" do %>
      <div class="col-md-4">
        <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Rechercher un Ã©vÃ©nement..." %>
      </div>
      <div class="col-md-3">
        <%= date_field_tag :date, params[:date], class: "form-control" %>
      </div>
      <div class="col-md-2">
        <%= submit_tag "Filtrer", class: "btn btn-primary w-100" %>
      </div>
    <% end %>
  </div>

  <div class="row g-4">
    <% @events.each do |event| %>
      <div class="col-md-6 col-lg-4">
        <div class="card shadow-sm h-100">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title text-primary"><%= event.title %></h5>
            <p class="card-text text-muted flex-grow-1"><%= event.description %></p>

            <ul class="list-unstyled mb-3">
              <li>ğŸ“ <%= event.location %></li>
              <li>ğŸ•’ <%= l(event.starts_at, format: :long) %> - <%= l(event.ends_at, format: :long) %></li>
            </ul>

            <% if event.message&.conversation %>
              <%= link_to "ğŸ‘‰ Voir la conversation", conversation_path(event.message.conversation), class: "btn btn-outline-primary btn-sm" %>
            <% else %>
              <span class="text-muted">âŒ Pas de conversation liÃ©e</span>
            <% end %>

            <div class="event-actions">
              <% if current_user && event.users.include?(current_user) %>
                <%= button_to "ğŸš« je me dÃ©sinscris",
                  event_event_participation_path(event, event.event_participations.find_by(user: current_user)),
                  method: :delete,
                  data: { confirm: "Es-tu sÃ»r de vouloir te dÃ©sinscrire de cet Ã©vÃ©nement ?" },
                  class: "btn-action" %>
              <% else %>
                <%= button_to "âœ… Je m'inscris",
                  event_event_participations_path(event),
                  method: :post,
                  class: "btn-action" %>
              <% end %>

              <%= button_to event_path(event),
                    method: :delete,
                    data: { confirm: "Es-tu sÃ»r de vouloir supprimer cet Ã©vÃ©nement ?" },
                    form: { style: "display:inline" },
                    class: "btn-action btn-delete" do %>
                  <i class="fa-solid fa-trash-can"></i>
                <% end %>
            </div>





          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
