 <% content_for :page_title, "Ã‰vÃ¨nements" %>

    <% content_for :header do %>
      <%= render 'layouts/topbar_header' %>
    <% end %>

<div class="events-page" data-controller="events">
 <!-- Barre de recherche -->
  <div class="search-bar">
    <i class="fa-solid fa-magnifying-glass me-2"></i>
    <input type="text"
           placeholder="Rechercher un Ã©vÃ©nement..."
           data-events-target="searchInput"
           data-action="input->events#search">
  </div>


    <%= button_to conversations_path,
                    method: :post,
                    form: { data: { turbo: false } },
                    class: "p-0 border-0 bg-transparent w-100 text-start" do %>

      <%= render "layouts/infos_card",
            title: "FitBuddy â€“ CrÃ©ateur dâ€™Ã©vÃ¨nements",
            description: "CrÃ©e des Ã©vÃ¨nements sportifs en un instant ! Dis-moi quelle activitÃ© tu veux organiser et je tâ€™aide",
            icon: content_tag(:i, "", class: "fa-solid fa-bolt-lightning"),
            bg: "rgba(245, 235, 255, 1)",
            border_gradient: "linear-gradient(90deg, rgba(167, 79, 255, 0.35), rgba(22, 110, 253, 0.35))",
            icon_gradient: "linear-gradient(135deg, rgba(167, 79, 255, 1), rgba(22, 110, 253, 1))"
      %>

    <% end %>

  <!-- Boucle dynamique -->
  <% @events.each do |event| %>
    <div class="event-card" data-events-target="card">
      <div class="event-header d-flex justify-content-between align-items-start">
        <div class="d-flex align-items-center event-title">
          <h3 class="mb-0"><%= event.title %></h3>
        </div>

        <div class="event-date-tag ms-auto">
          <%= l(event.starts_at.to_date, format: "%d %b %Y") %>
        </div>
      </div>
      <p class="event-desc"><%= event.description %></p>
      <ul class="event-info list-unstyled pt-2">
        <li class="d-flex align-items-center">
          <i class="fa-solid fa-location-dot me-2 text-secondary"></i>
          <span><%= event.location %></span>
        </li>
        <li class="d-flex align-items-center">
          <i class="fa-solid fa-users me-2 text-secondary"></i>
          <span>Participants : <%= ["3", "5", "8", "10"].sample %></span>
        </li>

        <% levels = { "dÃ©butant" => 1, "intermÃ©diaire" => 2, "avancÃ©" => 3 } %>
        <% current_level_label = ["dÃ©butant", "intermÃ©diaire", "avancÃ©"].sample %>
        <% current_level = levels[current_level_label] %>
        <div class="d-flex d-flex justify-content-between w-100 pt-2">
          <li class="d-flex align-items-center gap-2 mt-2">
            <%# <i class="fa-solid fa-signal text-secondary"></i> %>
            <span class="text-capitalize fw-bold"><%= current_level_label %></span>
            <div class="d-flex align-items-center gap-1">
              <% 1.upto(3) do |i| %>
                <div class="level-dot <%= 'active' if i <= current_level %>"></div>
              <% end %>
            </div>
          </li>
          <div class="event-footer">
            <%= turbo_frame_tag dom_id(event, :participation_button) do %>
              <% if current_user.events.include?(event) %>
                <%= button_to "Inscrit âœ…",
                              event_participation_path(current_user.event_participations.find_by(event: event)),
                              method: :delete,
                              class: "btn btn-success btn-join-inscrit" %>
              <% else %>
                <%= button_to "S'inscrire",
                              event_event_participations_path(event),
                              method: :post,
                              class: "btn btn-outline-primary btn-join" %>
              <% end %>
            <% end %>

          </div>
        </div>
      </ul>



    </div>
  <% end %>

  <!-- ðŸŒŸ Popup global -->
  <div id="signup-popup" class="popup-overlay hidden" data-events-target="popup">
    <div class="popup">
      <div class="popup-header">
        <i class="fa-solid fa-circle-check"></i>
      </div>
      <div class="popup-body">
        <h3>Inscription rÃ©ussie ðŸŽ‰</h3>
        <p>Bienvenue parmi nous ! Vous Ãªtes bien inscrit.</p>
      </div>
      <div class="popup-footer">
        <button class="popup-btn" data-action="click->events#closePopup">
          <i class="fa-solid fa-arrow-right"></i>
          <span>Continuer</span>
        </button>
      </div>
    </div>
  </div>
</div>
