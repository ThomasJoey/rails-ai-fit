<div class="events-page" data-controller="events">

  <!-- Barre de recherche -->
  <div class="search-bar">
    <i class="fa-solid fa-magnifying-glass me-2"></i>
    <input type="text"
           placeholder="Rechercher un événement..."
           data-events-target="searchInput"
           data-action="input->events#search">
  </div>


    <%= button_to conversations_path,
                    method: :post,
                    form: { data: { turbo: false } },
                    class: "p-0 border-0 bg-transparent w-100 text-start" do %>

      <%= render "layouts/infos_card",
            title: "FitBuddy – Créateur d’évènements",
            description: "Crée des évènements sportifs en un instant ! Dis-moi quelle activité tu veux organiser et je t’aide à la mettre en place",
            icon: content_tag(:i, "", class: "fa-solid fa-bolt-lightning"),
            bg: "rgba(240, 245, 255, 1)",
            border_gradient: "linear-gradient(90deg, rgba(14, 104, 252, 0.35), rgba(29, 229, 102, 0.35))",
            icon_gradient: "linear-gradient(135deg, rgba(14, 104, 252, 1), rgba(29, 229, 102, 1))"
      %>

    <% end %>

  <!-- Boucle dynamique -->
  <% @events.each do |event| %>
    <div class="event-card" data-events-target="card">
      <div class="event-header">
        <div class="event-icon">🎯</div>
        <div class="event-title">
          <h3><%= event.title %></h3>
        </div>
      </div>
      <p class="event-desc"><%= event.description %></p>
      <ul class="event-info list-unstyled">
        <li class="d-flex align-items-center">
          📅 <span class="ms-2"><%= l(event.starts_at, format: :long) %></span>
        </li>
        <li class="d-flex align-items-center">
          📍 <span class="ms-2"><%= event.location %></span>
        </li>
        <li class="d-flex align-items-center">
          <i class="fa-solid fa-users me-2 text-secondary"></i>
          <span>Participants : <%= ["3", "5", "8", "10"].sample %></span>
        </li>
        <li class="d-flex align-items-center">
          <i class="fa-solid fa-signal me-2 text-secondary"></i>
          <span>Niveau : <%= ["débutant", "intermédiaire", "avancé"].sample %></span>
        </li>
      </ul>


      <div class="event-footer">
        <%= turbo_frame_tag dom_id(event, :participation_button) do %>
          <% if current_user.events.include?(event) %>
            <%= button_to "Inscrit ✅",
                          event_participation_path(current_user.event_participations.find_by(event: event)),
                          method: :delete,
                          class: "btn btn-success btn-join" %>
          <% else %>
            <%= button_to "S'inscrire",
                          event_event_participations_path(event),
                          method: :post,
                          class: "btn btn-outline-primary btn-join" %>
          <% end %>
        <% end %>

      </div>

    </div>
  <% end %>

  <!-- 🌟 Popup global -->
  <div id="signup-popup" class="popup-overlay hidden" data-events-target="popup">
    <div class="popup">
      <h3>✅ Inscription réussie</h3>
      <p>Vous êtes bien inscrit…</p>
      <button class="btn-close" data-action="click->events#closePopup">Fermer</button>

    </div>
  </div>


</div>
