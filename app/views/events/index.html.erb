<div class="events-page" data-controller="events">

  <!-- Barre de recherche -->
  <div class="search-bar">
    <i class="fa-solid fa-magnifying-glass me-2"></i>
    <input type="text"
           placeholder="Rechercher un événement..."
           data-events-target="searchInput"
           data-action="input->events#search">
  </div>


    <%= button_to conversations_path,
                    method: :post,
                    form: { data: { turbo: false } },
                    class: "p-0 border-0 bg-transparent w-100 text-start" do %>

      <%= render "layouts/infos_card",
            title: "FitBuddy Event Creator",
            description: "Create sport events instantly! Tell me what activity you want to organize and I’ll help you set it up",
            icon: content_tag(:i, "", class: "fa-solid fa-bolt-lightning"),
            bg: "rgba(240, 245, 255, 1)",
            border_gradient: "linear-gradient(90deg, rgba(14, 104, 252, 0.35), rgba(29, 229, 102, 0.35))",
            icon_gradient: "linear-gradient(135deg, rgba(14, 104, 252, 1), rgba(29, 229, 102, 1))"
      %>

    <% end %>

  <!-- Boucle dynamique -->
  <% @events.each do |event| %>
    <div class="event-card" data-events-target="card">
      <div class="event-header">
        <div class="event-icon">🎯</div>
        <div class="event-title">
          <h3><%= event.title %></h3>
        </div>
      </div>

      <p class="event-desc"><%= event.description %></p>
      <ul class="event-info">
        <li>📅 <%= l(event.starts_at, format: :long) %></li>
        <li>📍 <%= event.location %></li>
      </ul>

      <div class="event-footer">
        <%= turbo_frame_tag dom_id(event, :participation_button) do %>
          <% if current_user.events.include?(event) %>
            <%= button_to "Inscrit ✅",
                          event_participation_path(current_user.event_participations.find_by(event: event)),
                          method: :delete,
                          class: "btn btn-success btn-join" %>
          <% else %>
            <%= button_to "S'inscrire",
                          event_event_participations_path(event),
                          method: :post,
                          class: "btn btn-outline-primary btn-join" %>
          <% end %>
        <% end %>

      </div>

    </div>
  <% end %>

  <!-- 🌟 Popup global -->
  <div class="popup hidden" data-events-target="popup">
    <div class="popup-content">
      <h3>✅ Inscription réussie</h3>
      <p>Vous êtes bien inscrits.<br>
         Si l’activité est payante, veuillez penser à venir avec un moyen de paiement 💳.</p>
      <button class="btn-close" data-action="click->events#closePopup">Fermer</button>
    </div>
  </div>
</div>
