<div class="chat-page d-flex flex-column h-100">
  <!-- Header conversation -->
  <div class="chat-header d-flex align-items-center p-3 border-bottom">
    <a href="<%= conversations_path %>" class="me-3 text-decoration-none text-dark">
      <i class="fa-solid fa-arrow-left"></i>
    </a>

    <%= render "layouts/avatar",
      initials: @conversation.second_user&.first_name&.first&.upcase || "?",
      image_url: (url_for(@conversation.second_user.avatar) if @conversation.second_user&.avatar&.attached?),
      gradient: "gradient-purple-pink",
      size: "md",
      extra_classes: "me-2" %>

    <div class="d-flex flex-column ms-2 user-name">
      <%= @conversation.second_user&.first_name %> <%= @conversation.second_user&.last_name %>
    </div>
</div>

  <!-- Zone de messages -->
  <div class="chat-messages flex-grow-1 p-3 overflow-auto">
    <% if @conversation.human_chat? %>
      <%= render "message_users/messages",
                 message_users: @conversation.message_users.includes(:sender).chronological %>
    <% else %>
      <%= render "messages/messages",
                 messages: @conversation.messages.order(:created_at) %>
    <% end %>
  </div>

  <!-- Zone de réponse -->
  <div class="chat-input border-top p-3">
    <% if @conversation.human_chat? %>
      <%= render "message_users/form",
                 conversation: @conversation,
                 message_user: @message_user %>
    <% else %>
      <%= render "messages/form",
                 conversation: @conversation,
                 message: @message %>
    <% end %>
  </div>

  <% unless @conversation.human_chat? %>
    <div class="mt-2 text-center">
      <%= button_to "Générer l'événement",
                    create_events_conversation_path(@conversation),
                    method: :post,
                    class: "btn btn-dark px-4 mt-2" %>
    </div>
  <% end %>
</div>
